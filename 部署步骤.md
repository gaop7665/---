# ğŸš€ Cloudflare éƒ¨ç½²æ­¥éª¤

## ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½² Workerï¼ˆåç«¯ï¼‰

### 1. å®‰è£…ä¾èµ–å¹¶ç™»å½•

æ‰“å¼€ç»ˆç«¯ï¼ˆPowerShellï¼‰ï¼Œåœ¨é¡¹ç›®ç›®å½•è¿è¡Œï¼š

```powershell
# è¿›å…¥é¡¹ç›®ç›®å½•
cd C:\Users\admin\Desktop\CF

# å®‰è£…ä¾èµ–
npm install

# ç™»å½•åˆ° Cloudflareï¼ˆä¼šæ‰“å¼€æµè§ˆå™¨è®©ä½ æˆæƒï¼‰
npx wrangler login
```

### 2. åˆ›å»º KV æ•°æ®åº“

```powershell
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒ KV
npx wrangler kv:namespace create "URL_DB"

# åˆ›å»ºé¢„è§ˆç¯å¢ƒ KV
npx wrangler kv:namespace create "URL_DB" --preview
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
```
â›…ï¸ wrangler 3.x.x
-------------------
ğŸŒ€ Creating namespace with title "cf-url-shortener-URL_DB"
âœ¨ Success!
Add the following to your configuration file in your kv_namespaces array:
{ binding = "URL_DB", id = "abc123def456..." }

â›…ï¸ wrangler 3.x.x
-------------------
ğŸŒ€ Creating namespace with title "cf-url-shortener-URL_DB_preview"
âœ¨ Success!
Add the following to your configuration file in your kv_namespaces array:
{ binding = "URL_DB", preview_id = "xyz789abc123..." }
```

**é‡è¦ï¼šå¤åˆ¶è¿™ä¸¤ä¸ª IDï¼**

### 3. æ›´æ–° wrangler.toml

ç”¨è®°äº‹æœ¬æˆ–ç¼–è¾‘å™¨æ‰“å¼€ `wrangler.toml`ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š

```toml
name = "cf-url-shortener"
main = "src/index.js"
compatibility_date = "2024-01-01"

# KV Namespace binding
[[kv_namespaces]]
binding = "URL_DB"
id = "ç²˜è´´è¿™é‡Œï¼šç”Ÿäº§ç¯å¢ƒçš„ID"
preview_id = "ç²˜è´´è¿™é‡Œï¼šé¢„è§ˆç¯å¢ƒçš„ID"

# Environment variables
[vars]
ADMIN_TOKEN = "è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼Œä¾‹å¦‚ï¼šMySecureToken123456"
BASE_URL = "https://cf-url-shortener.ä½ çš„ç”¨æˆ·å.workers.dev"

# Production environment (optional)
[env.production]
name = "cf-url-shortener-prod"
```

### 4. éƒ¨ç½² Worker

```powershell
npm run deploy
```

éƒ¨ç½²æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ï¼š
```
âœ¨ Success! Uploaded 1 files (x.xx sec)
Published cf-url-shortener (x.xx sec)
  https://cf-url-shortener.ä½ çš„ç”¨æˆ·å.workers.dev
```

**å¤åˆ¶è¿™ä¸ª URLï¼è¿™æ˜¯ä½ çš„ Worker API åœ°å€ã€‚**

### 5. æµ‹è¯• Worker API

åœ¨æµè§ˆå™¨è®¿é—®ï¼š
```
https://cf-url-shortener.ä½ çš„ç”¨æˆ·å.workers.dev
```

ä½ åº”è¯¥çœ‹åˆ° API ä¿¡æ¯ã€‚

---

## ç¬¬äºŒæ­¥ï¼šéƒ¨ç½² Pagesï¼ˆå‰ç«¯ï¼‰

### æ–¹æ³• Aï¼šé€šè¿‡ Cloudflare Dashboardï¼ˆæ¨èï¼‰

1. **æ›´æ–°å‰ç«¯ API åœ°å€**

åœ¨éƒ¨ç½² Pages ä¹‹å‰ï¼Œå…ˆæ›´æ–°å‰ç«¯çš„ API åœ°å€ã€‚

ç¼–è¾‘ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼Œå°† `const API_BASE = window.location.origin;` æ”¹ä¸ºä½ çš„ Worker URLï¼š

- `public/index.html`
- `public/admin.html`
- `public/stats.html`

æ‰¾åˆ°è¿™è¡Œï¼š
```javascript
const API_BASE = window.location.origin;
```

æ”¹ä¸ºï¼š
```javascript
const API_BASE = 'https://cf-url-shortener.ä½ çš„ç”¨æˆ·å.workers.dev';
```

ä¿å­˜åæäº¤åˆ° GitHubï¼š
```powershell
git add .
git commit -m "Update API endpoint"
git push
```

2. **åœ¨ Cloudflare åˆ›å»º Pages é¡¹ç›®**

- è®¿é—®ï¼šhttps://dash.cloudflare.com/
- ç‚¹å‡»å·¦ä¾§èœå• **Workers & Pages**
- ç‚¹å‡» **Create application**
- é€‰æ‹© **Pages** é€‰é¡¹å¡
- ç‚¹å‡» **Connect to Git**

3. **è¿æ¥ GitHub ä»“åº“**

- é€‰æ‹©ä½ çš„ GitHub è´¦æˆ·
- é€‰æ‹© `cf-url-shortener` ä»“åº“
- ç‚¹å‡» **Begin setup**

4. **é…ç½®æ„å»ºè®¾ç½®**

```
Project name: cf-url-shortener
Production branch: main
Build command: ï¼ˆç•™ç©ºï¼‰
Build output directory: public
```

5. **ç‚¹å‡» "Save and Deploy"**

ç­‰å¾…å‡ åˆ†é’Ÿï¼Œéƒ¨ç½²å®Œæˆåä½ ä¼šå¾—åˆ°ä¸€ä¸ª URLï¼š
```
https://cf-url-shortener.pages.dev
```

---

## ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•å®Œæ•´åŠŸèƒ½

### 1. æµ‹è¯•å‰ç«¯

è®¿é—®ä½ çš„ Pages URLï¼š
```
https://cf-url-shortener.pages.dev
```

### 2. åˆ›å»ºçŸ­é“¾æ¥

- è¾“å…¥ä¸€ä¸ªé•¿ URLï¼Œä¾‹å¦‚ï¼š`https://www.cloudflare.com`
- ç‚¹å‡» "Shorten URL"
- å¤åˆ¶ç”Ÿæˆçš„çŸ­é“¾æ¥

### 3. æµ‹è¯•çŸ­é“¾æ¥

è®¿é—®ç”Ÿæˆçš„çŸ­é“¾æ¥ï¼Œåº”è¯¥ä¼šé‡å®šå‘åˆ°åŸå§‹ URLã€‚

### 4. æµ‹è¯•ç®¡ç†é¢æ¿

è®¿é—®ï¼š
```
https://cf-url-shortener.pages.dev/admin.html
```

è¾“å…¥ä½ åœ¨ `wrangler.toml` ä¸­è®¾ç½®çš„ `ADMIN_TOKEN`ï¼Œåº”è¯¥èƒ½çœ‹åˆ°æ‰€æœ‰é“¾æ¥åˆ—è¡¨ã€‚

---

## æ–¹æ³• Bï¼šå‘½ä»¤è¡Œéƒ¨ç½² Pagesï¼ˆå¤‡é€‰ï¼‰

å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ GitHub è‡ªåŠ¨éƒ¨ç½²ï¼Œå¯ä»¥ç›´æ¥éƒ¨ç½²ï¼š

```powershell
# é¦–å…ˆæ›´æ–° API åœ°å€ï¼ˆåŒä¸Šï¼‰
# ç„¶åç›´æ¥éƒ¨ç½² public ç›®å½•

npx wrangler pages deploy public --project-name=cf-url-shortener
```

---

## ğŸ‰ å®Œæˆï¼

ä½ çš„ URL çŸ­é“¾æ¥æœåŠ¡ç°åœ¨å·²ç»å®Œå…¨éƒ¨ç½²å¥½äº†ï¼

- ğŸŒ **å‰ç«¯åœ°å€**ï¼šhttps://cf-url-shortener.pages.dev
- ğŸ”— **API åœ°å€**ï¼šhttps://cf-url-shortener.ä½ çš„ç”¨æˆ·å.workers.dev
- ğŸ‘‘ **ç®¡ç†é¢æ¿**ï¼šhttps://cf-url-shortener.pages.dev/admin.html

---

## ğŸ“ é‡è¦æé†’

1. âœ… è®°ä½ä½ çš„ ADMIN_TOKEN
2. âœ… Worker URL å’Œ Pages URL éƒ½å·²å‡†å¤‡å¥½
3. âœ… å‰ç«¯çš„ API_BASE å·²æ›´æ–°ä¸º Worker URL
4. âœ… å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼

---

## ğŸ”§ å¸¸è§é—®é¢˜

**Q: æç¤º "KV namespace not found"**
A: ç¡®ä¿ `wrangler.toml` ä¸­çš„ KV ID å·²æ­£ç¡®å¡«å†™

**Q: å‰ç«¯æ— æ³•åˆ›å»ºçŸ­é“¾æ¥**
A: æ£€æŸ¥å‰ç«¯æ–‡ä»¶ä¸­çš„ `API_BASE` æ˜¯å¦æŒ‡å‘æ­£ç¡®çš„ Worker URL

**Q: ç®¡ç†é¢æ¿æç¤º "Unauthorized"**
A: ç¡®è®¤è¾“å…¥çš„ ADMIN_TOKEN ä¸ `wrangler.toml` ä¸­è®¾ç½®çš„ä¸€è‡´

**Q: éœ€è¦è‡ªå®šä¹‰åŸŸå**
A: åœ¨ Cloudflare Dashboard ä¸­å¯ä»¥ä¸º Worker å’Œ Pages åˆ†åˆ«æ·»åŠ è‡ªå®šä¹‰åŸŸå

