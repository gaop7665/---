# 🚀 CF URL Shortener 更新指南

## 📋 本次更新内容

1. ✅ 界面改为中文显示
2. ✅ 添加中英文切换功能
3. ✅ 完善密码保护功能
4. ✅ API 地址修改为 `https://link.xswweb.com`
5. ✅ 修改版权信息为"由 www.xswweb.com 提供支持"
6. ✅ 管理面板链接放在版权信息后面

---

## 🔄 需要修改的文件

### 1. `public/index.html` - 主页面
### 2. `public/admin.html` - 管理面板
### 3. `public/stats.html` - 统计页面
### 4. `public/verify.html` - 密码验证页面（新建）
### 5. `src/index.js` - Worker 后端代码

---

## 📝 更新步骤

### 步骤 1：在 GitHub 上替换文件

#### 1.1 更新 `public/index.html`

1. 打开 GitHub 仓库
2. 进入 `public` 文件夹
3. 点击 `index.html`
4. 点击编辑按钮（铅笔图标）
5. **删除所有内容**
6. 复制 `public/index.html.new` 的内容
7. 粘贴到编辑器
8. 提交更改

#### 1.2 更新 `public/admin.html`

由于篇幅限制，我会在下一条消息提供完整的 `admin.html` 代码。

操作步骤同上。

#### 1.3 更新 `public/stats.html`

操作步骤同上。

#### 1.4 创建 `public/verify.html`（新文件）

这是密码验证页面，访问受密码保护的短链接时会跳转到这个页面。

1. 在 `public` 文件夹中点击 **"Add file"** > **"Create new file"**
2. 文件名输入：`verify.html`
3. 粘贴代码
4. 提交

#### 1.5 更新 `src/index.js`

这个文件添加了完整的密码验证逻辑。

---

## 🎯 更新后的功能

### 1. 中英文切换
- 右上角有语言切换按钮
- 点击可在中文和英文之间切换
- 所有文字都会相应改变

### 2. 密码保护
- 创建短链接时可设置密码
- 访问时会跳转到密码验证页面
- 输入正确密码后才能访问目标 URL
- 密码使用 SHA-256 加密存储

### 3. 新的版权信息
```
由 www.xswweb.com 提供支持    管理面板
```

---

## ✅ 验证清单

更新完成后，测试以下功能：

- [ ] 访问主页，界面显示中文
- [ ] 点击右上角语言切换按钮，切换到英文
- [ ] 创建一个普通短链接
- [ ] 生成的链接是 `https://link.xswweb.com/xxx`
- [ ] 创建一个带密码保护的短链接
- [ ] 访问带密码的短链接，显示密码输入页面
- [ ] 输入正确密码，跳转成功
- [ ] 输入错误密码，显示错误提示
- [ ] 查看统计页面
- [ ] 访问管理面板
- [ ] 底部显示"由 www.xswweb.com 提供支持"

---

## 📌 注意事项

1. **所有文件都要更新完成**才能正常工作
2. 更新后 Cloudflare Pages 会自动重新部署（需要 2-3 分钟）
3. 部署完成后，强制刷新浏览器（Ctrl + Shift + R）
4. 如果遇到问题，检查浏览器控制台（F12）的错误信息

---

## 🔧 技术细节

### 密码验证流程

```
用户访问短链接
    ↓
Worker 检查是否有密码
    ↓ 有密码
跳转到 verify.html?code=xxx
    ↓
用户输入密码
    ↓
调用 /api/verify 验证密码
    ↓ 正确
生成临时 token
    ↓
跳转到 /:code?token=xxx
    ↓
验证 token 后跳转到目标 URL
```

### API 变更

新增接口：
- `POST /api/verify` - 验证密码
- `GET /:code?token=xxx` - 使用 token 访问

---

## 📂 文件结构

```
CF/
├── public/
│   ├── index.html (已更新)
│   ├── admin.html (需更新)
│   ├── stats.html (需更新)
│   ├── verify.html (新建)
│   └── _headers
├── src/
│   └── index.js (需更新)
└── ...
```

---

## 💡 下一步

我会在接下来的消息中提供：
1. `admin.html` 的完整代码
2. `stats.html` 的完整代码
3. `verify.html` 的完整代码
4. `src/index.js` 的完整代码

请告诉我是否继续！

